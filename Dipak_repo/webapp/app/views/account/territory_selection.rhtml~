<%- @page_title = "Buyer Webpage" -%>
<% require_js_controllers :tab, :account_settings -%>

<%- content_for :page_scripts do -%>

Event.observe(window, 'load', function() {
  account_settings_controller = new NL.AccountSettingsController();
         $('state_code_state_code').observe('change', function(){
        state_id = $('state_code_state_code').value
        new Ajax.Request('/account/get_territories?state_id='+state_id,
          {
          method:'get',
          onSuccess: function(transport){
          var response = transport.responseText || "no response text";
          $('ajax_update_div').innerHTML = response
          },
        onFailure: function(){ alert('Something went wrong...') }
        });
        });
});

  function full_territory(this_id)
  {
      var children = this_id.getElementsByTagName('div');
            for (var i=0; i < children.length; i++) { 
                children[i].classNames().remove("span_display_none");
                children[i].classNames().add("span_display_block");
            }
  }
  function short_territory(this_id)
  {
      var children = this_id.getElementsByTagName('div');
            for (var i=0; i < children.length; i++) { 
                children[i].classNames().remove("span_display_block");
                children[i].classNames().add("span_display_none");
            }
   }

<%- end -%>
<div class="full">

  <div class="tabset larger">
    <ul>
      <li  uri="<%=url_for({:controller=>'account', :action=>'settings'})%>">Investor Profile</li>
      <li uri="<%=url_for({:controller=>'account', :action=>'company_info'})%>">Company Info</li>
      <li  class="active" uri="<%=url_for({:controller=>'account', :action=>'buyer_webpage'})%>">Buyer Websites</li>
      <li uri="<%=url_for({:controller=>'account', :action=>'marketing'})%>">Buyer Responder</li>
      <li uri="<%=url_for({:controller=>'account', :action=>'digest_frequency'})%>">Alerts</li>
    </ul>
  </div>
<%= stylesheet_link_tag "investor_buyer_page" %>
  <fieldset>
<%- form_for(@user_territory, :url => {:controller=>'account', :action=>'save_user_territory'} ,
:html => { :multipart => true }) do |f| -%>
    <table>
      <tr>
        <td colspan="2">
          My territory(s)
        </td>
      </tr>
      <tr>
        <td width="23%;"  valign="top">
           <div>
            <% index = 0 %>
           <% @user_territories.each do |user_territory| %>
               <span>
                  <% if !user_territory.territory.nil? && !user_territory.territory.territory_name.blank? %>
                          <% span_territory_name = user_territory.territory.territory_name %>
                          <% index = index + 1 %>
                      <span class="half">
                          <a href="/account/buyer_webpage?territory_name=<%=span_territory_name%>" onmouseover="full_territory(this)" onmouseout="short_territory(this)">
                              <%=index.to_s + ". " +  span_territory_name.split("(")[0] %><div class="span_display_none" style="text-decoration:underline;"><%=span_territory_name.gsub(span_territory_name.split("(")[0], "") %></div>
                          </a>
                        </span>
                      <br/>
                  <% end%>
               </span>
            <%end%>
            </div>
            <%="None Selected" if @user_territories.size == 0%>
            <div style="margin-top:50px;">
              <span style="font-weight:bold;" >
	      <%= link_to_remote( "Territory Helper" , :url => { :action=>"territory_helper" },
	               :update => { :success => "territory_helper", :failure => "error" })
 	      %>
	       </span>
            </div>
        </td>
        <td align="left" valign="top">
          <div>
              You currently have <b><%=@max_no_of_territories %> Territories</b> available. Use the drop down menus below to  select the state, then Territory, where you want to Activate your Buyer Website(s).
          </div>
          <div class="right_row_div">
            <div class="left_float_left">
            </div>
             <div class="inner_right_div">
            </div>
          </div>
          <div style="height:110px;" class="right_row_div">
            <div class="left_float_left">
              <b>Territory <%=@user_territories.size + 1 %></b>
              <%=error_message_on :user_territory,:user_id %>
            </div>
              <br/><br/>
             <div class="inner_right_div">
              <select name="state_code[state_code]" id="state_code_state_code">
                <option value="">--- Select State --- </option>
                   <% @states.each do |state|%>
                      <option value="<%=state.id%>" <%if @state_id == state.id %> selected="true" <%end%> ><%=state.name%></option>
                    <%end%>
              </select>
              </div>
              <br/><br/>
             <div class="inner_right_div" id="ajax_update_div">
                <%=select("user_territory","territory_id",@territories.map { |territory| [territory.territory_name, territory.id]  },{ :include_blank => "--- Select Territories --- " })%>
                <%=error_message_on :user_territory,:territory_id %>
              </div>
          </div>

          <div class="right_row_div">
            <div class="left_float_left" >
	   
            </div>
             <div class="inner_right_div">
             </div>
           </div>
 <div id="territory_helper">
	    </div>
          <div class="right_row_div">
            <div class="left_float_left">
            </div>
           </div>
	  
            <br/>
            <div class="right_row_div">
              <div class="left_float_left">
                <%=submit_tag "Update Settings", :class=>'submit_xl' %>
              </div>
            </div>
        </td>
      </tr>
    </table>
<%-end-%>
</fieldset>

</div>
